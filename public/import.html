<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö - God & Devils CRM</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚òÅÔ∏è</text></svg>">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #1d1d1f; }
        input, button {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #d1d1d6;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
        }
        .success { background: #e8f5e8; color: #388e3c; }
        .error { background: #ffebee; color: #d32f2f; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚òÅÔ∏è –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª database-export.json –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã:</p>
        
        <input type="file" id="fileInput" accept=".json">
        <br>
        <button onclick="importData()">üöÄ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        
        <div id="status"></div>
        
        <hr style="margin: 30px 0;">
        <p><a href="/crm">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ CRM</a></p>
    </div>
    
    <script>
    async function importData() {
    const statusDiv = document.getElementById('status');
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (!file) {
        showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞', 'error');
        return;
    }
    
    try {
        showStatus('–ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª...', 'info');
        const text = await file.text();
        
        showStatus('–ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ...', 'info');
        const data = JSON.parse(text);
        
        if (!data.users || !data.clients) {
            showStatus('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ù—É–∂–Ω—ã –ø–æ–ª—è users –∏ clients', 'error');
            return;
        }
        
        showStatus(`–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º ${data.users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ ${data.clients.length} –∫–ª–∏–µ–Ω—Ç–æ–≤...`, 'info');
        
        const response = await fetch('/api/import-data', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                ...data,
                importKey: 'god-devils-import-2024'
            })
        });
        
        if (!response.ok) {
            const text = await response.text();
            console.log('Response:', text);
            showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status, 'error');
            return;
        }
        
        const result = await response.json();
        
        if (result.success) {
            showStatus('‚úÖ ' + result.message, 'success');
            fileInput.value = '';
        } else {
            showStatus('‚ùå ' + result.error, 'error');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        showStatus('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
    }
}
    
    function showStatus(message, type) {
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = message;
        statusDiv.className = 'status ' + type;
    }
    </script>
</body>
</html>